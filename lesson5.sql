/*Задание 1.
Пусть в таблице users поля created_at и updated_at оказались незаполненными. 
Заполните их текущими датой и временем.*/

use for_crud;

select * from users;

update users
set created_at = now(), updated_at = now();

select * from users;

/*Задание 2
Таблица users была неудачно спроектирована. 
Записи created_at и updated_at были заданы типом VARCHAR и в них долгое время помещались значения в формате 
20.10.2017 8:10. Необходимо преобразовать поля к типу DATETIME, сохранив введённые ранее значения*/
describe users;
DROP TABLE IF EXISTS users;
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) COMMENT 'Имя покупателя',
  birthday_at DATE COMMENT 'Дата рождения',
  created_at VARCHAR(50),
  updated_at VARCHAR(50)
) COMMENT = 'Покупатели';

INSERT INTO users (name, birthday_at, created_at, updated_at) VALUES
  ('Геннадий', '1990-10-05', '20.10.2017 8:10', '20.10.2017 8:10'),
  ('Наталья', '1984-11-12', '10.12.2017 1:11', '10.12.2017 1:11'),
  ('Александр', '1985-05-20', '10.12.2019 12:00', '10.12.2019 12:00'),
  ('Сергей', '1988-02-14', '10.12.2019 12:00', '10.12.2019 12:00'),
  ('Иван', '1998-01-12', '10.12.2019 12:00', '10.12.2019 12:00'),
  ('Мария', '1992-08-29', '10.12.2019 12:00', '10.12.2019 12:00');
  
  select * from users;
  select str_to_date(created_at, '%m.%d.%Y %H:%i') as created_at from users;
  
ALTER TABLE users 
ADD created_at_dt DATETIME, 
ADD updated_at_dt DATETIME;
UPDATE users
SET created_at_dt = STR_TO_DATE(created_at, '%d.%m.%Y %h:%i'),
    updated_at_dt = STR_TO_DATE(updated_at, '%d.%m.%Y %h:%i');
    select * from users;
ALTER TABLE users 
    DROP created_at, DROP updated_at, 
    RENAME COLUMN created_at_dt TO created_at, RENAME COLUMN updated_at_dt TO updated_at;
    
    select * from users;
/*Задание 3*/

DROP TABLE IF EXISTS storehouses_products;
CREATE TABLE storehouses_products (
  id SERIAL PRIMARY KEY,
  storehouse_id INT UNSIGNED,
  product_id INT UNSIGNED,
  value INT UNSIGNED COMMENT 'Запас товарной позиции на складе',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT = 'Запасы на складе';
INSERT INTO `storehouses_products` VALUES (1,33,96,81,'1991-12-01 19:50:38','1986-10-10 11:44:52'),(2,11,74,28,'1980-06-23 00:20:03','1981-07-15 00:15:46'),(3,31,168,77,'2001-01-29 14:45:54','1994-09-24 01:35:31'),(4,69,152,95,'1987-08-04 11:52:51','1971-10-08 21:49:18'),(5,21,197,1,'1983-04-12 03:30:23','1990-08-13 21:47:39'),(6,2,117,76,'1973-05-03 13:16:57','2016-07-06 11:36:27'),(7,5,168,28,'1981-03-11 00:04:44','2005-09-23 21:06:44'),(8,62,93,89,'2002-11-24 17:18:26','2014-11-18 04:59:03'),(9,18,37,34,'2021-01-10 00:23:58','1982-04-22 16:35:16'),(10,4,167,57,'1985-05-03 19:46:16','1993-04-04 13:02:27'),(11,13,119,76,'2008-09-04 15:33:23','1995-02-07 00:50:10'),(12,88,175,83,'2016-09-07 21:00:55','2011-11-24 22:49:01'),(13,94,162,17,'1970-07-15 05:45:15','2004-08-04 06:14:51'),(14,50,105,7,'2006-09-05 09:42:42','1988-02-13 15:55:59'),(15,61,48,0,'1986-09-17 10:06:45','1997-08-06 11:15:24'),(16,29,150,81,'1995-02-08 19:56:08','1990-10-03 02:22:45'),(17,19,24,72,'2000-03-11 08:26:45','2016-04-08 14:43:41'),(18,63,167,54,'2010-02-20 00:50:34','1985-07-25 01:00:55'),(19,53,175,12,'2014-07-19 11:37:24','1985-03-25 14:07:26'),(20,75,91,59,'1979-04-05 07:22:16','2002-01-03 19:48:47'),(21,24,39,88,'1988-01-16 17:04:42','1986-08-01 11:29:43'),(22,9,186,56,'2002-10-12 05:13:57','1970-05-26 23:02:17'),(23,90,19,69,'2017-02-01 00:33:07','1990-06-12 07:52:39'),(24,69,23,13,'2007-01-26 05:45:06','2000-04-18 06:15:46'),(25,52,11,51,'1976-09-03 04:31:05','2020-10-24 02:42:43'),(26,57,101,92,'2020-04-22 20:21:23','1995-03-24 05:04:15'),(27,50,58,31,'2017-04-03 15:19:53','1991-12-16 18:47:06'),(28,61,50,8,'2007-09-30 02:02:58','1996-02-17 09:06:09'),(29,5,68,25,'1995-06-29 02:35:29','1998-05-12 18:02:46'),(30,14,16,43,'1979-04-30 09:58:59','2000-05-10 18:01:00'),(31,20,139,93,'2018-01-18 22:37:49','2000-07-15 14:19:32'),(32,31,149,49,'1997-03-11 22:20:12','1985-03-14 20:17:09'),(33,17,126,9,'1997-07-04 03:08:22','2000-09-28 15:39:03'),(34,89,154,8,'2019-05-09 13:37:41','2011-10-07 00:48:09'),(35,73,14,64,'1978-02-24 10:19:36','2020-09-27 04:28:18'),(36,48,87,85,'1989-11-30 19:38:05','1979-12-01 15:07:56'),(37,2,187,16,'2015-01-21 23:02:47','2010-06-14 23:00:49'),(38,41,21,32,'1970-01-11 19:00:02','1992-01-16 09:59:53'),(39,37,63,70,'1972-08-14 11:42:59','1983-07-29 03:39:09'),(40,15,105,1,'2001-08-30 03:02:54','1995-01-16 13:58:41'),(41,61,165,16,'2002-03-07 05:16:31','2007-09-05 17:23:59'),(42,99,127,17,'2010-12-04 15:35:59','1986-10-27 09:21:30'),(43,73,43,30,'2020-12-21 17:00:13','2001-11-14 02:23:06'),(44,27,61,6,'1993-12-05 07:14:59','1979-10-23 22:40:03'),(45,98,177,5,'1985-01-12 01:15:56','2010-06-06 08:25:29'),(46,25,100,72,'1973-07-21 19:14:25','2019-11-10 05:08:39'),(47,21,117,30,'2008-07-28 05:33:18','2019-08-30 03:19:17'),(48,74,54,79,'1978-11-03 00:05:25','1977-06-02 12:49:23'),(49,97,18,14,'1980-11-18 11:51:11','2008-08-11 06:33:57'),(50,53,79,12,'1989-09-05 01:53:57','1975-01-13 05:33:29'),(51,48,178,5,'1971-03-21 21:36:44','1995-02-16 04:00:36'),(52,83,149,72,'2018-04-17 10:04:55','1983-03-17 12:17:31'),(53,58,137,62,'2019-03-20 19:50:06','1993-12-05 18:46:29'),(54,53,78,16,'1999-01-24 17:27:38','2010-11-08 09:44:28'),(55,29,161,20,'2007-08-21 00:06:56','1980-11-01 03:38:57'),(56,30,14,18,'2002-11-22 21:12:06','1970-02-25 14:23:34'),(57,31,86,3,'1988-01-02 19:52:21','1977-11-24 23:38:27'),(58,56,114,11,'2005-11-28 15:49:29','2017-12-18 12:31:01'),(59,79,71,13,'1991-11-02 11:17:36','1984-01-25 00:07:22'),(60,78,177,63,'1996-02-02 10:14:23','1991-01-22 05:41:39'),(61,74,199,97,'1970-06-08 02:55:16','2002-07-26 00:47:16'),(62,46,17,57,'1981-04-25 06:34:25','1978-01-27 13:00:39'),(63,4,140,57,'1983-12-09 00:41:42','1995-04-11 15:47:57'),(64,85,56,94,'1994-01-15 00:16:41','1995-08-05 07:43:18'),(65,99,50,57,'1983-03-22 07:19:59','2001-02-26 04:33:20'),(66,9,16,18,'1975-11-14 16:52:05','2012-06-05 03:47:12'),(67,63,16,64,'1988-07-14 11:36:05','1997-08-29 13:52:11'),(68,36,174,0,'2020-06-03 03:27:06','2016-05-27 13:18:06'),(69,24,81,77,'2018-05-11 01:07:23','2018-09-17 14:00:45'),(70,29,191,41,'2008-05-21 14:35:32','1987-04-18 17:35:56'),(71,4,21,98,'1995-04-15 07:40:29','1988-06-03 11:08:41'),(72,72,104,71,'1971-02-25 15:43:30','1982-09-09 19:33:48'),(73,89,17,23,'2009-08-11 14:43:54','2016-01-01 06:59:15'),(74,45,16,85,'2017-07-18 07:42:20','2011-12-25 03:26:49'),(75,81,19,45,'1987-11-23 08:37:56','2004-07-28 03:32:04'),(76,77,111,56,'2008-09-20 06:56:41','1974-09-12 10:26:16'),(77,4,35,72,'2003-01-12 03:32:17','1991-08-07 16:51:09'),(78,99,163,56,'2005-08-06 01:35:15','2004-06-15 18:55:24'),(79,25,105,92,'1994-01-18 03:24:00','1971-07-21 05:57:34'),(80,57,74,13,'1973-08-19 14:58:12','1994-12-24 23:53:53'),(81,39,113,86,'1979-02-14 08:08:15','1976-11-23 08:12:08'),(82,8,122,27,'2014-06-23 20:31:26','1987-09-02 23:19:18'),(83,86,55,50,'1975-04-20 01:57:42','2013-09-08 09:45:06'),(84,16,136,78,'2006-07-25 01:14:57','2003-01-16 00:58:41'),(85,29,197,43,'2012-09-29 09:28:21','1992-06-28 03:35:34'),(86,55,53,78,'2011-12-01 20:28:28','2015-11-27 14:49:43'),(87,76,41,95,'2015-06-13 00:53:44','2005-10-25 23:08:08'),(88,81,28,37,'2012-07-10 08:05:31','1984-03-08 13:11:10'),(89,66,200,91,'1976-01-12 06:49:42','1975-10-27 07:27:11'),(90,45,53,29,'2014-04-06 09:53:37','2002-08-16 16:35:26'),(91,48,6,30,'2003-12-26 17:12:28','1988-07-04 15:16:24'),(92,24,28,4,'2012-11-17 14:11:40','2005-04-18 16:40:17'),(93,65,158,75,'1995-09-08 21:12:02','1987-09-30 12:49:36'),(94,47,191,0,'1976-03-22 10:58:01','1974-07-02 16:51:52'),(95,71,19,19,'2010-04-19 23:59:45','2010-04-08 11:07:34'),(96,70,70,67,'2006-10-20 19:12:32','2020-11-13 09:58:21'),(97,58,120,8,'1994-01-14 18:50:55','2003-04-13 12:10:53'),(98,66,180,23,'1979-12-27 01:21:53','2014-04-09 14:31:09'),(99,11,117,59,'1976-12-21 05:28:25','1976-07-11 09:30:00'),(100,59,120,29,'1996-04-19 01:26:17','2006-05-31 19:42:36');

select * from storehouses_products
ORDER BY value = 0, value;


/*Задание 4
(по желанию) Из таблицы users необходимо извлечь пользователей, 
родившихся в августе и мае. Месяцы заданы в виде списка английских названий (may, august)*/
select * from users;
select id, name, birthday_at, date_format(birthday_at, "%M") as month_name from users
where month(birthday_at) in (5,8);

/*Задание 5
(по желанию) Из таблицы catalogs извлекаются записи при помощи запроса. 
SELECT * FROM catalogs WHERE id IN (5, 1, 2); 
Отсортируйте записи в порядке, заданном в списке IN.*/
SELECT * FROM catalogs 
WHERE id IN(5, 1, 2)
order by field(id,5,1,2);
